<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="/static/othello.css">
  <meta charset="UTF-8" />
  <title>Othello ‚Äî Personal Goal Architect</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

</head>

<body>
    <div id="connect-overlay" class="waking-overlay" style="display:none;">
      <div class="waking-overlay__spinner" id="connect-spinner"></div>
      <div id="connect-status" class="waking-overlay__status" style="margin-top:1.2rem;">Connecting to server‚Ä¶</div>
      <button id="connect-retry" class="waking-overlay__retry">Retry</button>
    </div>
    <div id="login-overlay" class="waking-overlay" style="display:none;">
      <div class="login-card">
        <div class="login-title">Sign in</div>
        <div class="login-subtitle">Enter your access code to load your goals.</div>
        <form id="loginForm" class="login-form">
          <input id="login-pin" class="login-input" type="password" placeholder="Access code" autocomplete="current-password" required />
          <button id="login-btn" class="login-button" type="submit">Continue</button>
          <div id="login-error" class="login-error"></div>
        </form>
      </div>
    </div>
    <div id="settings-overlay" class="settings-overlay">
      <div class="settings-modal" role="dialog" aria-modal="true" aria-labelledby="settings-title">
        <div class="settings-header">
          <div class="settings-title" id="settings-title">Settings</div>
          <button id="settings-close" class="settings-close" type="button">Close</button>
        </div>
        <div class="settings-section" id="settings-dev-reset" style="display:none;">
          <div class="danger-zone">
            <div class="danger-zone__title">Danger zone</div>
            <div class="danger-zone__desc">Wipe all data in the database. Dev only.</div>
            <label class="settings-label" for="dev-reset-confirm">Type RESET to confirm.</label>
            <input id="dev-reset-confirm" class="settings-input" type="text" placeholder="RESET" autocomplete="off" />
            <button id="dev-reset-btn" class="settings-button danger" type="button" disabled>Wipe all data (dev only)</button>
            <div id="settings-status" class="settings-status"></div>
          </div>
        </div>
        <div class="settings-section" id="settings-clear-data">
          <div class="danger-zone">
            <div class="danger-zone__title">Danger zone</div>
            <div class="danger-zone__desc">Clear per-user data. This cannot be undone.</div>
            <div class="settings-actions">
              <button id="clear-goals-btn" class="settings-button danger" type="button">Clear Goals</button>
              <button id="clear-plans-btn" class="settings-button danger" type="button">Clear Plans</button>
              <button id="clear-routines-btn" class="settings-button danger" type="button">Clear Routines</button>
              <button id="clear-insights-btn" class="settings-button danger" type="button">Clear Insights</button>
              <button id="clear-history-btn" class="settings-button danger" type="button">Clear History</button>
            </div>
            <div id="clear-data-status" class="settings-status"></div>
          </div>
        </div>
      </div>
    </div>
    <div id="archive-overlay" class="settings-overlay" style="display:none;">
      <div class="settings-modal" role="dialog" aria-modal="true" aria-labelledby="archive-title">
        <div class="settings-header">
          <div class="settings-title" id="archive-title">Archive goal?</div>
          <button id="archive-close" class="settings-close" type="button">Close</button>
        </div>
        <div class="settings-section">
          <div class="settings-label" id="archive-goal-label">This will archive the goal.</div>
          <div id="archive-status" class="settings-status"></div>
          <div class="archive-actions">
            <button id="archive-cancel" class="settings-button" type="button">Cancel</button>
            <button id="archive-confirm" class="settings-button danger" type="button">Archive goal</button>
          </div>
        </div>
      </div>
    </div>
  <div class="shell">

    <!-- HEADER -->
    <header>
      <div class="brand">
        <div class="brand-row">
          <div class="brand-title">Othello</div>
          <div class="mode-switch">
            <button class="mode-pill" id="mode-toggle" aria-haspopup="listbox" aria-expanded="false">
              <span id="current-mode-label">Companion Chat</span>
              <span class="chevron">‚ñº</span>
            </button>
            <div class="mode-dropdown" id="mode-dropdown" role="listbox">
              <button class="mode-option" data-mode="companion" role="option">Companion Chat</button>
              <button class="mode-option" data-mode="today" role="option">Today Planner</button>
              <button class="mode-option" data-mode="routine" role="option">Routine Planner</button>
            </div>
          </div>
        </div>
        <div class="brand-subtitle" id="mode-subtitle">Personal Goal Architect</div>
      </div>

      <div class="status-pill">
        <div class="dot"></div>
        <span id="status">Online</span>
      </div>
    </header>

    <!-- TAB NAVIGATION -->
    <nav class="tab-bar">
      <button class="tab active" data-view="chat">Chat</button>
      <button class="tab" data-view="goals" id="middle-tab">
        <span class="tab-label">Goals</span>
        <span class="tab-badge hidden" id="middle-tab-badge"></span>
      </button>
      <button class="tab" data-view="insights" id="insights-tab">
        <span class="tab-label">Insights</span>
        <span class="tab-badge hidden" id="insights-tab-badge"></span>
      </button>
    </nav>

    <!-- FOCUS RIBBON (shown when a goal is active in Chat view) -->
    <div id="focus-ribbon" class="focus-ribbon">
      <div class="focus-ribbon__text">
        <div class="focus-ribbon__label">Current Focus</div>
        <div class="focus-ribbon__title" id="focus-ribbon-title">No goal selected</div>
      </div>
      <button class="focus-ribbon__btn" id="view-focus-btn">View Goal</button>
      <button class="focus-ribbon__btn" id="update-focus-btn">Update Focus</button>
      <button class="focus-ribbon__btn" id="append-focus-btn">Append to Focus</button>
      <button class="focus-ribbon__btn" id="unfocus-btn">Unfocus</button>
    </div>

    <!-- CONTENT CONTAINER -->
    <div class="content-container">

      <!-- CHAT VIEW -->
      <div id="chat-view" class="view active">
        <div id="chat-placeholder" class="chat-placeholder">Start a conversation</div>
        <div id="chat-log" class="chat-log"></div>
      </div>

      <!-- TODAY PLANNER PLACEHOLDER -->
      <div id="today-planner-view" class="view">
        <div class="planner-shell" id="planner-shell">
          <div style="display: flex; justify-content: flex-end; margin-bottom: 0.5rem;">
             <button id="week-view-toggle" class="planner-action-btn" style="font-size: 0.8rem; padding: 0.4rem 0.8rem;">Week View</button>
             <button id="suggestions-toggle" class="planner-action-btn" style="font-size: 0.8rem; padding: 0.4rem 0.8rem; margin-left: 0.5rem;">Suggestions</button>
          </div>
          
          <div id="planner-suggestions-panel" class="planner-card" style="display: none; margin-bottom: 1rem; border: 1px solid var(--accent);">
             <div class="planner-card__header" style="display: flex; justify-content: space-between; align-items: center;">
                <div class="planner-section__title">Suggestions</div>
                <button id="generate-suggestions-btn" class="planner-action-btn" style="font-size: 0.8rem;">Generate</button>
             </div>
             <div id="suggestions-list" style="padding: 1rem;"></div>
          </div>
          
          <div id="planner-week-view" style="display: none;">
             <div class="planner-card">
                <div class="planner-card__header">
                   <div class="planner-section__title">This Week</div>
                </div>
                <div id="week-view-content" class="planner-blocks"></div>
             </div>
          </div>

          <div id="planner-day-view">
          <div class="planner-card planner-brief" id="planner-brief">
            <div class="planner-headline" id="planner-headline">Loading...</div>
            <div class="planner-subline" id="planner-energy"></div>
          </div>
          <div id="planner-error" class="planner-error" style="display:none;"></div>
          <div class="planner-card" id="today-plan-card">
            <div class="planner-card__header">
              <div class="planner-section__title">Today Plan</div>
              <div class="planner-section__count" id="today-plan-count"></div>
            </div>
            <div class="planner-actions" style="margin-bottom: 0.75rem;">
              <button class="planner-action-btn" id="build-plan-btn">Build today's plan</button>
              <div class="planner-section__count" id="build-plan-status"></div>
            </div>
            <div id="today-plan-error" class="planner-error" style="display:none;"></div>
            <div class="planner-blocks" id="today-plan-items"></div>
            <div class="planner-section__title" style="margin-top: 0.75rem;">Pending Suggestions</div>
            <div class="planner-blocks" id="today-plan-suggestions"></div>
          </div>
          <div class="planner-card" id="planner-routines">
            <div class="planner-card__header">
              <div class="planner-section__title">Routines</div>
              <div class="planner-section__count" id="planner-routines-count"></div>
            </div>
            <div class="planner-blocks" id="planner-routines-list"></div>
          </div>
          <div class="planner-card" id="planner-goals">
            <div class="planner-card__header">
              <div class="planner-section__title">Goal Tasks</div>
              <div class="planner-section__count" id="planner-goals-count"></div>
            </div>
            <div class="planner-blocks" id="planner-goals-list"></div>
          </div>
          </div> <!-- End planner-day-view -->
        </div>
      </div>

      <!-- ROUTINE PLANNER VIEW -->
      <div id="routine-planner-view" class="view">
        <div class="view-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem;">
          <h2 class="view-title">Routine Planner</h2>
          <button id="routine-preview-plan-btn" class="settings-button" style="font-size: 0.85rem; padding: 0.4rem 0.8rem;">
            Preview Today Plan
          </button>
        </div>
        <div class="routine-planner-layout" style="display: grid; grid-template-columns: 300px 1fr; gap: 1.5rem; height: calc(100vh - 140px);">
          <!-- Left: List -->
          <div class="routine-list-panel" style="background: var(--bg-2); border: 1px solid var(--border); border-radius: 12px; display: flex; flex-direction: column;">
            <div style="padding: 1rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
              <span style="font-weight: 600; color: var(--text-main);">Routines</span>
              <button id="routine-add-btn" class="icon-button" title="New Routine">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
              </button>
            </div>
            <div id="routine-list" style="flex: 1; overflow-y: auto; padding: 0.5rem;">
              <!-- Routine items injected here -->
            </div>
          </div>

          <!-- Right: Editor -->
          <div id="routine-editor" class="routine-editor-panel" style="background: var(--bg-2); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; display: none; flex-direction: column; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.5rem;">
              <div style="flex: 1; margin-right: 1rem;">
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.4rem;">
                  <button id="routine-mobile-back-btn" class="icon-button" style="width: 28px; height: 28px; font-size: 0.9rem;">‚Üê</button>
                  <label style="display: block; font-size: 0.85rem; color: var(--text-soft);">Routine Name</label>
                </div>
                <input type="text" id="routine-title-input" class="login-input" style="width: 100%; font-size: 1.1rem; font-weight: 600;">
              </div>
              <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 0.5rem;">
                <button id="routine-save-btn" class="login-button" style="padding: 0.3rem 0.8rem; font-size: 0.85rem;">Save</button>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                  <input type="checkbox" id="routine-enabled-toggle">
                  <span style="font-size: 0.9rem; color: var(--text-main);">Active</span>
                </label>
                <button id="routine-delete-btn" style="color: #fca5a5; background: none; border: none; font-size: 0.85rem; cursor: pointer; text-decoration: underline;">Delete Routine</button>
              </div>
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; font-size: 0.85rem; color: var(--text-soft); margin-bottom: 0.4rem;">Schedule (Days)</label>
              <div id="routine-days" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                <!-- Checkboxes for mon..sun -->
              </div>
            </div>

            <div style="flex: 1; display: flex; flex-direction: column;">
              <div id="routine-steps-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.8rem;">
                <span style="font-size: 0.95rem; font-weight: 600; color: var(--text-main);">Steps</span>
                <button id="routine-add-step-btn" class="login-button" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;">+ Add Step</button>
              </div>
              <div id="routine-steps" style="display: flex; flex-direction: column; gap: 0.5rem;">
                <!-- Steps injected here -->
              </div>
            </div>
          </div>
          
          <div id="routine-empty-state" class="routine-empty-placeholder" style="display: flex; align-items: center; justify-content: center; background: var(--bg-2); border: 1px solid var(--border); border-radius: 12px;">
            No routines yet ‚Äî tap + to create your first routine.
          </div>
        </div>
      </div>

      <!-- GOALS VIEW -->
      <div id="goals-view" class="view">
        <div id="goals-list" class="goals-list"></div>
      </div>

      <!-- INSIGHTS VIEW -->
      <div id="insights-view" class="view">
        <div id="insights-content">
          <div id="insights-error" class="insights-empty" style="display:none;">Unable to load insights right now.</div>
          <div id="insights-empty" class="insights-empty">No pending insights right now.</div>
          <div id="insights-list" class="insights-grid"></div>
        </div>
      </div>

    </div>

    <div id="toast-container"></div>

    <!-- INPUT BAR (only visible in Chat view) -->
    <div class="input-bar" id="input-bar">
      <input id="user-input" placeholder="Tell Othello what you're working towards..." />
      <button id="mic-btn" class="mic-btn" title="Start voice input">üé§</button>
      <button id="cancel-transcript-btn" class="cancel-transcript-btn hidden" title="Clear transcript">Cancel</button>
      <button id="send">Send</button>
    </div>

    <!-- GOAL DETAIL VIEW (overlay) -->
    <div id="goal-detail" class="goal-detail">
      <div class="goal-detail__header">
        <div class="goal-detail__header-top">
          <button class="back-btn" id="back-from-detail">‚Üê</button>
          <div class="goal-detail__id" id="detail-goal-id">Goal #1</div>
          <button class="goal-detail__refresh" id="goal-detail-refresh">Refresh</button>
        </div>
        <h1 class="goal-detail__title" id="detail-goal-title">Goal Title</h1>
      </div>
      <div class="goal-detail__content" id="detail-content">
        <!-- Dynamic content injected here -->
      </div>
      <div class="goal-detail__actions">
        <button class="continue-btn" id="continue-working-btn">Continue working on this goal</button>
        <button class="settings-button danger goal-archive-btn" id="archive-goal-btn">Archive goal</button>
      </div>
    </div>

    <!-- PLAN PREVIEW MODAL -->
    <div id="plan-preview-overlay" class="settings-overlay">
      <div class="settings-modal" style="width: min(600px, 95%); max-height: 85vh; display: flex; flex-direction: column;">
        <div class="settings-header">
          <div class="settings-title">Today Plan Preview</div>
          <button id="plan-preview-close" class="settings-close">Close</button>
        </div>
        <div id="plan-preview-content" style="overflow-y: auto; flex: 1; padding-right: 0.5rem;">
          <div style="text-align: center; color: var(--text-soft); padding: 2rem;">Loading plan...</div>
        </div>
        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border); font-size: 0.85rem; color: var(--text-soft);">
          This is a read-only preview based on your current routines and goals.
        </div>
      </div>
    </div>

  </div>

  <div id="toast" class="toast"></div>

  <!-- JS -->
  <script src="/static/othello.js"></script>
</html>
